/*!
 * jQuery Feeds v0.5
 * https://camagu.github.com/jquery-feeds
 * 
 * Copyright (c) 2012, Camilo Aguilar
 * Dual licensed under the MIT and GPL licenses:
 *     http://www.opensource.org/licenses/mit-license.php
 *     http://www.gnu.org/licenses/gpl.html
 * 
 * Includes a modified version of Simple JavaScript Templating
 * http://ejohn.org/blog/javascript-micro-templating/
 * Copyright (c) John Resig (http://ejohn.org)
 * MIT licensed
 * 
 * Date: 2012-07-12
 */
(function(a){var b={};a.fn.feeds=function(c){var d={service:"//ajax.googleapis.com/ajax/services/feed/load?v=1.0",settings:{loadingTemplate:'<p class="feeds-loader">Loading entries ...</p>',entryTemplate:'<div class="feeds-entry feeds-source-<!=source!>"><a class="feed-entry-title" target="_blank" href="<!=link!>" title="<!=title!>"><!=title!></a><div class="feed-entry-date"><!=publishedDate!></div><div class="feed-entry-content"><!=contentSnippet!></div></div>',feeds:{},max:-1,ssl:"auto",onComplete:function(a){},preprocess:function(a,b){}},feeds:{},entries:[],feedsLength:0,feedsLoaded:0,$element:null,$loader:null,init:function(b,c){this.settings=a.extend(this.settings,c),this.feeds=this.settings.feeds;for(var d in this.feeds)this.feeds.hasOwnProperty(d)&&this.feedsLength++;var e=this.settings.ssl==="auto"?document.location.protocol:this.settings.ssl?"https:":"http:";a.inArray(e,["http:","https"])===-1&&(e="https:"),this.service=e+this.service,this.$element=a(b);var f=typeof this.settings.loadingTemplate=="function"?this.settings.loadingTemplate:this.tmpl(this.settings.loadingTemplate);this.$loader=a(f.call(this,{})),this.$element.html(this.$loader);for(var g in this.feeds)this.fetchFeed(g,this.feeds[g],this.settings.max)},fetchFeed:function(c,d,e){var f=this,g=d+"**"+e;if(typeof b[g]!="undefined"){f.processResponse(b[g],c,d);return}a.ajax({url:this.service,dataType:"jsonp",data:{q:d,num:e},beforeSend:function(){this.feed=d,this.key=c},success:function(a){b[g]=a,f.processResponse(a,this.key,this.feed)}})},processResponse:function(b,c,d){if(b.responseStatus!==200)window.console&&window.console.log&&console.log("Unable to load feed "+d+": ("+b.responseStatus+") "+b.responseDetails);else{var e=b.responseData.feed.entries;for(var f in e){var g=a.extend({},e[f]);g.source=c,g.publishedDateRaw=g.publishedDate,g.feedUrl=b.responseData.feed.feedUrl,g.feedTitle=b.responseData.feed.title,g.feedLink=b.responseData.feed.link,g.feedDescription=b.responseData.feed.description,g.feedAuthor=b.responseData.feed.author,this.settings.preprocess.call(g,b.responseData.feed),this.entries.push(g)}}this.feedsLoaded++,this.checkComplete()},checkComplete:function(){if(this.feedsLoaded===this.feedsLength){this.$loader.remove(),this.entries.sort(function(a,b){var c=(new Date(a.publishedDateRaw)).getTime(),d=(new Date(b.publishedDateRaw)).getTime();return d-c});var a=typeof this.settings.entryTemplate=="function"?this.settings.entryTemplate:this.tmpl(this.settings.entryTemplate);for(var b in this.entries){var c=this.entries[b],d=a.call(this,c);this.$element.append(d)}this.settings.onComplete.call(this.$element[0],this.entries)}},tmplCache:{},tmpl:function(a,b){var c=/\W/.test(a)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<!").join("\t").replace(/((^|!>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)!>/g,"',typeof $1 != 'undefined' ? $1 : '','").split("\t").join("');").split("!>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):this.tmplCache[a]=this.tmplCache[a]||this.tmpl(document.getElementById(a).innerHTML);return b?c(b):c}};return a(this).each(function(){d.init(this,c)})}})(jQuery);